"use strict";angular.module("comicsApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","adaptive.detection","naif.base64","angular-loading-bar","contenteditable","updateMeta"]).config(["$locationProvider","$routeProvider",function(a,b){b.when("/",{redirectTo:"/comics/new"}).when("/comics/new",{templateUrl:"views/comics/new.html",controller:"ComicsNewCtrl",controllerAs:"ComicsNewCtrl"}).when("/comics/index",{templateUrl:"views/comics/index.html",controller:"ComicsIndexCtrl",controllerAs:"ComicsIndexCtrl"}).when("/comics/show/:comicId",{templateUrl:"views/comics/show.html",controller:"ComicsShowCtrl",controllerAs:"ComicsShowCtrl"}).otherwise({redirectTo:"/"}),a.hashPrefix("!")}]).factory("Comic",["$resource",function(a){return a("/api/comics/:id.json",null,{update:{method:"PUT"}})}]).factory("Stripe",["$resource",function(a){return a("/api/comics/:comicId/stripes/:id.json",{comicId:"@comicId"},{update:{method:"PUT"}})}]),angular.module("comicsApp").factory("ExifRestorer",function(){var a=function(){var a={};return a.restore=function(a,b){if(!a.match("data:image/jpeg;base64,"))return b;var c=this.decode64(a.replace("data:image/jpeg;base64,","")),d=this.slice2Segments(c),e=this.exifManipulation(b,d);return this.encode64(e)},a.exifManipulation=function(a,b){var c=this.getExifArray(b),d=this.insertExif(a,c),e=new Uint8Array(d);return e},a.getExifArray=function(a){for(var b,c=0;c<a.length;c++)if(b=a[c],255==b[0]&225==b[1])return b;return[]},a.insertExif=function(a,b){var c=a.replace("data:image/jpeg;base64,",""),d=this.decode64(c),e=d.indexOf(255,3),f=d.slice(0,e),g=d.slice(e),h=f;return h=h.concat(b),h=h.concat(g)},a.slice2Segments=function(a){for(var b=0,c=[];;){if(255==a[b]&218==a[b+1])break;if(255==a[b]&216==a[b+1])b+=2;else{var d=256*a[b+2]+a[b+3],e=b+d+2,f=a.slice(b,e);c.push(f),b=e}if(b>a.length)break}return c},a.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a.encode64=function(a){var b,c,d,e,f,g="",h="",i="",j=0;do b=a[j++],c=a[j++],h=a[j++],d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+this.KEY_STR.charAt(d)+this.KEY_STR.charAt(e)+this.KEY_STR.charAt(f)+this.KEY_STR.charAt(i),b=c=h="",d=e=f=i="";while(j<a.length);return g},a.decode64=function(a){var b,c,d,e,f,g="",h="",i=0,j=[],k=/[^A-Za-z0-9\+\/\=]/g;k.exec(a)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=this.KEY_STR.indexOf(a.charAt(i++)),e=this.KEY_STR.indexOf(a.charAt(i++)),f=this.KEY_STR.indexOf(a.charAt(i++)),h=this.KEY_STR.indexOf(a.charAt(i++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,g=(3&f)<<6|h,j.push(b),64!=f&&j.push(c),64!=h&&j.push(g),b=c=g="",d=e=f=h="";while(i<a.length);return j},a}();return a}),angular.module("comicsApp").directive("camera",["$q","ExifRestorer",function(a,b){window.URL=window.URL||window.webkitURL;var c=function(a){var b=800;return a.width<b&&a.height<b?1:a.width>a.height?b/a.width:b/a.height},d=function(d){if(1===d.length&&0===d[0].type.indexOf("image/")){var e=a.defer(),f=a.defer(),g=a.defer(),h=new Image;h.onload=function(){var a=document.createElement("canvas"),b=a.getContext("2d"),d=c(this);a.width=this.width*d>>0,a.height=this.height*d>>0,b.drawImage(this,0,0,a.width,a.height);var e=a.toDataURL("image/jpeg",.8);f.resolve(e),h=null,a=null,b=null};var i=new FileReader;return i.onloadend=function(a){g.resolve(a.target.result)},h.src=URL.createObjectURL(d[0]),i.readAsDataURL(d[0]),a.all([f.promise,g.promise]).then(function(a){var c=a[0],d=a[1];b.restore(c,d),e.resolve(d)}),e.promise}};return{restrict:"E",template:'<input type="file" capture="camera" accept="image/*" id="camera" style="visibility: hidden;" /><div class="row"><button class="expanded secondary hollow button" ng-click="takePhoto()"><i class="fa fa-camera"></i> Take / Upload Photo</button></div>',scope:{onSelect:"&"},link:function(a,b){var c=b.find("input");c.on("change",function(b){a.onSelect({photo:d(b.target.files)})}),a.takePhoto=function(){c[0].click()}}}}]),angular.module("comicsApp").controller("ComicsNewCtrl",["$detection","Comic","Stripe","$location",function(a,b,c,d){var e=this;e.userAgent=a.getUserAgent(),e.isMobile=a.isAndroid()||a.isiOS(),e.comicId=0,e.hasErrors=!1,e.errors=[],e.uploadedImage={filename:"No file selected"},e.stripes=[],e.createStripe=function(){e.hasErrors=!1;var a=new c;a.stripe={caption:"",image:{data:"data:"+e.uploadedImage.filetype+";base64,"+e.uploadedImage.base64,content_type:e.uploadedImage.filetype,filename:e.uploadedImage.filename}},a.$save({comicId:e.comicId},function(a){e.stripes.push(a),e.uploadedImage={filename:"No file selected"}},function(a){e.uploadedImage={filename:"No file selected"},e.hasErrors=!0,e.errors=[],e.errors=a.data.errors})},e.upload=function(){if(e.hasErrors=!1,null!=e.uploadedImage.base64)if(0==e.comicId){var a=new b;a.comic={is_published:!1},b.save(a,function(a){e.comicId=a.id,e.createStripe()},function(a){e.hasErrors=!0,e.errors=[],e.errors=a.data.errors})}else e.createStripe();else e.hasErrors=!0,e.errors=[],e.errors.push("You must select a file")},e.updateCaption=function(a){var b=new c;b.stripe={id:a.id,caption:a.caption},b.$update({comicId:e.comicId,id:a.id},function(a){},function(a){e.hasErrors=!0,e.errors=[],e.errors=a.data.errors})},e.updateOrder=function(a,b){var d=new c;d.stripe={id:a,order:b},d.$update({comicId:e.comicId,id:a},function(a){e.updateComicData()},function(a){e.hasErrors=!0,e.errors=[],e.errors=a.data.errors})},e.deleteStripe=function(a){c["delete"]({comicId:e.comicId,id:a.id},function(a){e.updateComicData()},function(a){e.hasErrors=!0,e.errors=[],e.errors=a.data.errors})},e.updateComicData=function(){b.get({id:e.comicId},function(a){e.stripes=a.stripes},function(a){e.hasErrors=!0,e.errors=[],e.errors=a.data.errors})},e.publish=function(){var a=new b;a.comic={id:e.comicId,is_published:!0},a.$update({id:e.comicId},function(a){d.path("comics/show/"+e.comicId)},function(a){e.hasErrors=!0,e.errors=[],e.errors=a.data.errors})}}]),angular.module("comicsApp").controller("ComicsIndexCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("comicsApp").controller("ComicsShowCtrl",["$routeParams","Comic",function(a,b){var c=this;c.stripes=[],c.init=function(){b.get({id:a.comicId},function(a){c.stripes=a.stripes},function(a){console.log(a)})},c.init()}]),angular.module("comicsApp").run(["$templateCache",function(a){a.put("views/comics/index.html","<p>This is the comics/index view.</p>"),a.put("views/comics/new.html",'<div ng-show="ComicsNewCtrl.hasErrors" class="row alert-box alert radius"> <p ng-repeat="error in ComicsNewCtrl.errors">{{error}}</p> </div> <div class="new-comic"> <div class="row title"> Comic Creator </div> <div class="row upload-title"> Upload an image </div> <div class="row file-upload"> <div class="small-11 medium-7 large-5 columns"> <input type="file" capture="camera" accept="image/*" class="file-input" ng-model="ComicsNewCtrl.uploadedImage" base-sixty-four-input> <div class="row file-upload-component"> <div class="left small-6 medium-7 large-7 columns file-name"> {{ComicsNewCtrl.uploadedImage.filename}} </div> <div class="right choose-file"> Choose File </div> </div> </div> <div class="small-11 left medium-2 columns clear-fix"> <a class="button upload-btn" ng-click="ComicsNewCtrl.upload()">Upload</a> </div> </div> </div> <div class="comic-stripes"> <div class="row"> <div ng-repeat="stripe in ComicsNewCtrl.stripes | orderBy:\'order\'" class="small-11 medium-3 large-3 columns left"> <div class="show-for-medium-up row image"> <span ng-click="ComicsNewCtrl.deleteStripe(stripe)" class="delete">x</span> <img ng-src="{{stripe.web_image_url.replace(\':9000\',\':3000\')}}"> </div> <div class="show-for-small-only row image"> <span ng-click="ComicsNewCtrl.deleteStripe(stripe)" class="delete">x</span> <img ng-src="{{stripe.mobile_image_url.replace(\':9000\',\':3000\')}}"> </div> <div id="caption-{{stripe.id}}" ng-model="stripe.caption" contenteditable="true" placeholder="Write Caption" ng-blur="ComicsNewCtrl.updateCaption(stripe)" class="row caption"> </div> <div class="row order-actions"> <span ng-show=" stripe.order == 1" class="left-arrow"> <img src="images/disabled-left-arrow.24b73700.png"> </span> <span ng-click="ComicsNewCtrl.updateOrder(stripe.id,stripe.order-1)" ng-hide=" stripe.order == 1" class="left-arrow"> <img src="images/left-arrow.18619e33.png"> </span> <span ng-show="$index == ComicsNewCtrl.stripes.length -1"> <img src="images/disabled-right-arrow.538a57e1.png"> </span> <span ng-click="ComicsNewCtrl.updateOrder(stripe.id,stripe.order+1)" ng-hide=" $index == ComicsNewCtrl.stripes.length -1"> <img src="images/right-arrow.c022005d.png"> </span> </div> </div> </div> </div> <div class="row" ng-show="ComicsNewCtrl.stripes.length > 0"> <div class="clear-fix"> <a class="button publish-btn" ng-click="ComicsNewCtrl.publish()">PUBLISH COMIC</a> </div> </div>'),a.put("views/comics/show.html",'<update-meta itemprop="image" content="{{ComicsShowCtrl.stripes[0].web_image_url}}"> <update-meta name="twitter:image:src" content="{{ComicsShowCtrl.stripes[0].web_image_url}}"> <update-meta property="og:image" content="{{ComicsShowCtrl.stripes[0].web_image_url}}"> <div class="comic-stripes comic-view"> <div class="row"> <div ng-repeat="stripe in ComicsShowCtrl.stripes | orderBy:\'order\'" class="small-11 medium-3 large-3 columns left"> <div class="show-for-medium-up row image"> <img ng-src="{{stripe.web_image_url.replace(\':9000\',\':3000\')}}"> </div> <div class="show-for-small-only row image"> <img ng-src="{{stripe.mobile_image_url.replace(\':9000\',\':3000\')}}"> </div> <div id="caption-{{stripe.id}}" ng-bind-html="stripe.caption" class="row caption"> </div> </div> </div> </div></update-meta></update-meta>')}]);